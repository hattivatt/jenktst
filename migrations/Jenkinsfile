pipeline {

    agent any

    environment {
      TEST="1TEST1"
      if (env.JOB_NAME == 'testing') {
        TEST="2TEST2"
      }
    }

    stages {
        stage('test1') {
            steps {
                sh './start.sh'
		sh 'pwd'
		sh 'migrations/tests.sh'
		sh 'echo $JOB_NAME'
		sh 'echo $JOB_BASE_NAME'
		sh 'echo $TEST'
            }
        }
        stage('test2') {
	    when {
	        changeset "migrations/*.sh"
	    }
            steps {
                sh 'cd migrations; ./tests.sh'
            }
        }
        stage('test3') {
            steps {
                sh 'echo "Let\'s wrap it up"'
            }
        }
    }
}
